# redis分布式锁处理高并发

## **应用场景**

在隆众后台系统中,有个价格中心-指标管理模块下,实现功能为指标信息的添加操作,功能需求如下:

```java
1. 在指标信息的添加操作中有个指标code的字段,这个字段的要求为按照指定规格有序的生成例(lz_gs_lg_000001,lz_gs_lg_000002,lz_gs_lg_000003)
2. 指标code在表中是唯一的,创建了唯一索引,所以指标添加的时候,要对指标code进行判重,保证添加的code表中不存在
3. 项目为分布式的,4台服务上每台都会部署该应用程序
4. 操作人员群体少,但是操作的时间段比较集中,存在并发的可能性(每天5-10人,在早高峰8:30-9:00的时间段内没人大约创建10-20条左右的指标)
```

## 技术方案分析

业务逻辑的流程:

	1. 应该先生成有序的code,然后进行插入操作,如果出现并发情况的话,可能会出现表中存在相同的code
	2. 第一步的先提就是先创建唯一索引,保证表中不可能存在重复的code
### 方案一 应用mysql的sql直接生成code

```java
1. 首先考虑到有4台服务器,每台都有该应用程序,所以可以直接不考虑使用线程锁的方式进行
2. 考虑到使用mysql中的函数实现新建数据同时产生有序的code,这种操作的本质还是会先执行查询然后执行添加操作
3. 如果考虑mysql的行级锁的话,仅仅是锁住了并发操作同一行数据,不适合本业务场景
4. 如果考虑表级锁的话,整表锁住,可实现操作,但是锁的粒度太粗,效率不高
5. 综上所诉暂不考虑这种方式
```

### 方案二 应用redis分布式锁实现并发问题的处理

```java
1. redis分布式锁的方式,锁住生成code和添加指标的业务逻辑的内容
2. 设置key的有效期为20秒,重试时间为100毫秒重试一次,重试时间为3秒即可
3. 超出3秒,还是出现并发的操作的话,弹出提示即可
```



# RabbitMQ实现高并发处理

## 应用场景



```java

```

